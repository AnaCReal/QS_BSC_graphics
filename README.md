---
title: "Graphics for cities' paper abstract"
author: "Ana Real"
date: "1/23/2020"
output: 
  html_document:
    keep_md: true
---



## Map for Ranks


```r
library(openxlsx)
library(plotly)
```

```
## Loading required package: ggplot2
```

```
## 
## Attaching package: 'plotly'
```

```
## The following object is masked from 'package:ggplot2':
## 
##     last_plot
```

```
## The following object is masked from 'package:stats':
## 
##     filter
```

```
## The following object is masked from 'package:graphics':
## 
##     layout
```

```r
df <- read.csv('https://raw.githubusercontent.com/plotly/datasets/master/2014_world_gdp_with_codes.csv')
setwd("/Users/anareal/Documents/Master/DataAnaly/citiesjournal")
data <- read.xlsx("citiespanel.xlsx")
data$Code <- "0"
df$COUNTRY <- as.character(df$COUNTRY)
df$CODE <- as.character(df$CODE)
for(i in c(1:496)){
        for(j in c(1:222)){
                if(data$Country[i]==df$COUNTRY[j]){
                        data$Code[i] <- df$CODE[j]
                }
        }
}

l <- list(color = toRGB("grey"), width = 0.5)

# specify map projection/options
g <- list(
  showframe = FALSE,
  showcoastlines = FALSE,
  projection = list(type = 'Mercator')
)

p <- plot_geo(data) %>%
  add_trace(
    z = ~Rank, color = ~Rank,
    text = ~Country, locations = ~Code, marker = list(line = l)
  ) %>%
  colorbar(title = 'Rank') %>%
  layout(
    title = 'Best Ranked City per Country in 2019, QS Best Student Cities',
    geo = g
  )

p
```

<!--html_preserve--><div id="htmlwidget-0ff162636f965596164b" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0ff162636f965596164b">{"x":{"visdat":{"6d659eb6640":["function () ","plotlyVisDat"]},"cur_data":"6d659eb6640","attrs":{"6d659eb6640":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"z":{},"color":{},"text":{},"locations":{},"marker":{"line":{"color":"rgba(190,190,190,1)","width":0.5}},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"mapType":"geo","scene":{"zaxis":{"title":"Rank"}},"geo":{"domain":{"x":[0,1],"y":[0,1]},"showframe":false,"showcoastlines":false,"projection":{"type":"Mercator"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5},"title":"Best Ranked City per Country in 2019, QS Best Student Cities"},"source":"A","config":{"showSendToCloud":false},"data":[{"colorbar":{"title":"Rank","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"z":[1,2,3,4,5,6,7,8,9,10,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,27,29,29,31,32,33,34,35,35,37,37,39,40,41,41,43,43,45,46,47,48,49,50,51,52,53,54,55,56,57,57,59,60,60,62,63,64,65,66,67,68,68,70,71,72,73,74,74,76,76,78,79,80,81,82,83,84,85,85,87,88,89,89,91,92,93,94,95,95,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,115,115,118,118,120,1,2,3,4,5,6,7,8,9,10,11,12,13,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,58,60,61,62,63,63,65,66,67,68,69,70,71,72,73,74,75,76,76,78,79,80,81,82,83,84,85,86,87,88,88,90,90,92,92,94,95,96,97,97,99,100,100,1,2,3,4,5,6,7,8,9,10,11,11,13,14,15,16,17,18,19,20,21,22,23,23,25,26,26,28,28,30,31,31,33,34,34,36,37,37,39,39,41,42,43,44,45,46,47,47,49,50,51,52,53,53,55,56,56,58,59,60,61,62,62,64,65,65,67,68,69,70,71,72,73,74,75,76,77,78,78,80,81,81,83,84,85,86,87,88,89,90,91,92,93,94,94,96,97,97,99,100,1,2,3,4,5,6,7,8,9,10,11,12,13,13,13,16,17,18,18,20,21,22,23,24,25,26,27,27,27,30,30,32,33,34,35,36,37,38,39,39,41,42,43,44,45,46,47,48,49,49,49,52,53,54,55,55,57,58,58,60,61,61,63,63,63,66,67,68,69,70,71,72,73,74,74,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,26,28,29,29,31,32,32,34,35,36,37,38,39,39,41,42,43,44,45,46,47,48,49,50,1,2,3,4,5,5,7,8,9,10,11,12,13,14,15,15,17,18,18,20,21,21,23,24,24,26,27,28,29,30,31,32,33,33,35,36,37,38,38,38,41,42,43,44,45,46,47,48,49,50],"text":["United Kingdom","Japan","Australia","Germany","Germany","Canada","France","Switzerland","Australia","South Korea","Hong Kong","Canada","United States","Austria","United Kingdom","Canada","Taiwan","Japan","United States","Singapore","Spain","Australia","Australia","Netherlands","United States","Australia","New Zeland","Spain","Malaysia","United Kingdom","Argentina","China","China","Russia","Czech Republic","United States","Ireland","Sweden","United Kingdom","Italy","United States","Australia","Belgium","Hungary","Canada","Denmark","United Kingdom","United Kingdom","United Kingdom","France","Poland","Portugal","Mexico","Chile","Sweden","Finland","United States","United Kingdom","Thailand","Czech Republic","United Arab Emirates","United States","United States","United Kingdom","New Zeland","Russia","United States","Taiwan","Germany","Italy","Turkey","Greece","Russia","France","Spain","United States","Brazil","South Africa","Austria","South Africa","India","Colombia","United Kingdom","Australia","Philippines","India","United States","United Arab Emirates","Turkey","South Korea","Mexico","Russia","United States","United States","Japan","Lithuania","United Kingdom","Peru","China","France","Lebanon","Brazil","United Kingdom","Poland","China","United Kingdom","Egypt","Poland","Indonesia","Latvia","Pakistan","Kazakhstan","India","United States","India","Pakistan","Canada","Ukraine","United Kingdom","Belarus","United Kingdom","Japan","Australia","Canada","France","Germany","Germany","Switzerland","Australia","South Korea","Austria","Hong Kong","United States","Canada","Singapore","United Kingdom","Canada","United States","Japan","Taiwan","Australia","Australia","New Zeland","United Kingdom","Argentina","China","Netherlands","Russia","China","Czech Republic","Spain","Spain","Sweden","Ireland","United States","Italy","Malaysia","United States","Australia","United States","Australia","France","United Kingdom","United Kingdom","Denmark","Canada","United Kingdom","Belgium","Hungary","Portugal","United Kingdom","Mexico","Poland","Thailand","United Kingdom","United Kingdom","Sweden","United States","Germany","United States","United Arab Emirates","United States","Czech Republic","Chile","Norway","Italy","Turkey","United States","New Zeland","Brazil","South Africa","Saudi Arabia","Taiwan","Russia","Finland","Greece","Russia","France","South Africa","United States","Colombia","Turkey","Mexico","Lithuania","Austria","South Korea","Australia","China","Canada","United States","Spain","United Kingdom","Japan","Egypt","Philippines","Russia","United States","France","India","United States","Brazil","Canada","France","United Kingdom","South Korea","Australia","Germany","Japan","United States","Germany","Canada","Hong Kong","Canada","Australia","Singapore","Switzerland","Austria","Japan","United Kingdom","United States","Australia","Taiwan","Australia","Spain","United Kingdom","China","Canada","Czech Republic","New Zeland","United States","China","Ireland","Spain","Italy","United Kingdom","France","Netherlands","Denmark","United States","United Kingdom","Russia","Malaysia","Argentina","United Kingdom","Australia","Belgium","United States","United States","Sweden","Portugal","Australia","Mexico","Poland","Sweden","Norway","United Kingdom","Hungary","United Kingdom","Thailand","Czech Republic","United States","Finland","United States","Chile","Saudi Arabia","United States","Italy","Greece","France","Brazil","Spain","Turkey","Canada","Colombia","New Zeland","Taiwan","Mexico","United Arab Emirates","Australia","Russia","China","Turkey","South Korea","United States","South Africa","India","India","United States","Egypt","Philippines","France","Russia","United States","Russia","Brazil","Findland","Lithuania","Ukraine","France","Peru","China","France","Australia","Japan","Australia","United Kingdom","Singapore","Canada","Hong Kong","Germany","South Korea","Germany","Switzerland","Canada","Canada","United States","Austria","Australia","New Zeland","Australia","United States","Japan","Spain","Taiwan","Sweden","China","Australia","Netherlands","United States","Denmark","Spain","United States","Argentina","United Kingdom","Finland","Australia","United Kingdom","Ireland","Italy","China","Czech Republic","Belgium","United States","Russia","United Kingdom","United States","France","New Zeland","United States","Chile","Mexico","Canada","Portugal","Malaysia","Sweden","Canada","Taiwan","United Kingdom","United States","United States","Norway","Italy","South Korea","Brazil","United Kingdom","Poland","United Kingdom","United Kingdom","United Arab Emirates","Australia","Spain","United States","United States","Czech Republic","France","Mexico","France","Australia","United Kingdom","Australia","Hong Kong","United States","Japan","Canada","Canada","South Korea","Switzerland","Canada","United States","Germany","Singapore","Germany","United States","United States","Spain","Austria","Australia","New Zeland","Australia","Argentina","Taiwan","China","United Kingdom","Denmark","Australia","United Kingdom","United States","Ireland","China","Japan","Sweden","Italy","Netherlands","Australia","Finland","Spain","United States","United States","Russia","Chile","United Kingdom","United States","Belgium","Japan","Czech Republic","Mexico","France","United Kingdom","Singapore","Australia","Australia","Switzerland","Hong Kong","United States","Canada","Germany","Germany","United States","Canada","South Korea","Ireland","Austria","Japan","New Zeland","China","Denmark","United States","Canada","United States","Italy","Spain","Australia","Sweden","Taiwan","United Kingdom","Australia","Spain","United Kingdom","Belgium","Argentina","China","Netherlands","Australia","United States","Australia","Russia","France","United States","Malaysia","United States","Czech Republic","Mexico","Finland","Norway","Chile","Japan"],"locations":["GBR","JPN","AUS","DEU","DEU","CAN","FRA","CHE","AUS","0","HKG","CAN","USA","AUT","GBR","CAN","TWN","JPN","USA","SGP","ESP","AUS","AUS","NLD","USA","AUS","0","ESP","MYS","GBR","ARG","CHN","CHN","RUS","CZE","USA","IRL","SWE","GBR","ITA","USA","AUS","BEL","HUN","CAN","DNK","GBR","GBR","GBR","FRA","POL","PRT","MEX","CHL","SWE","FIN","USA","GBR","THA","CZE","ARE","USA","USA","GBR","0","RUS","USA","TWN","DEU","ITA","TUR","GRC","RUS","FRA","ESP","USA","BRA","ZAF","AUT","ZAF","IND","COL","GBR","AUS","PHL","IND","USA","ARE","TUR","0","MEX","RUS","USA","USA","JPN","LTU","GBR","PER","CHN","FRA","LBN","BRA","GBR","POL","CHN","GBR","EGY","POL","IDN","LVA","PAK","KAZ","IND","USA","IND","PAK","CAN","UKR","GBR","BLR","GBR","JPN","AUS","CAN","FRA","DEU","DEU","CHE","AUS","0","AUT","HKG","USA","CAN","SGP","GBR","CAN","USA","JPN","TWN","AUS","AUS","0","GBR","ARG","CHN","NLD","RUS","CHN","CZE","ESP","ESP","SWE","IRL","USA","ITA","MYS","USA","AUS","USA","AUS","FRA","GBR","GBR","DNK","CAN","GBR","BEL","HUN","PRT","GBR","MEX","POL","THA","GBR","GBR","SWE","USA","DEU","USA","ARE","USA","CZE","CHL","NOR","ITA","TUR","USA","0","BRA","ZAF","SAU","TWN","RUS","FIN","GRC","RUS","FRA","ZAF","USA","COL","TUR","MEX","LTU","AUT","0","AUS","CHN","CAN","USA","ESP","GBR","JPN","EGY","PHL","RUS","USA","FRA","IND","USA","BRA","CAN","FRA","GBR","0","AUS","DEU","JPN","USA","DEU","CAN","HKG","CAN","AUS","SGP","CHE","AUT","JPN","GBR","USA","AUS","TWN","AUS","ESP","GBR","CHN","CAN","CZE","0","USA","CHN","IRL","ESP","ITA","GBR","FRA","NLD","DNK","USA","GBR","RUS","MYS","ARG","GBR","AUS","BEL","USA","USA","SWE","PRT","AUS","MEX","POL","SWE","NOR","GBR","HUN","GBR","THA","CZE","USA","FIN","USA","CHL","SAU","USA","ITA","GRC","FRA","BRA","ESP","TUR","CAN","COL","0","TWN","MEX","ARE","AUS","RUS","CHN","TUR","0","USA","ZAF","IND","IND","USA","EGY","PHL","FRA","RUS","USA","RUS","BRA","0","LTU","UKR","FRA","PER","CHN","FRA","AUS","JPN","AUS","GBR","SGP","CAN","HKG","DEU","0","DEU","CHE","CAN","CAN","USA","AUT","AUS","0","AUS","USA","JPN","ESP","TWN","SWE","CHN","AUS","NLD","USA","DNK","ESP","USA","ARG","GBR","FIN","AUS","GBR","IRL","ITA","CHN","CZE","BEL","USA","RUS","GBR","USA","FRA","0","USA","CHL","MEX","CAN","PRT","MYS","SWE","CAN","TWN","GBR","USA","USA","NOR","ITA","0","BRA","GBR","POL","GBR","GBR","ARE","AUS","ESP","USA","USA","CZE","FRA","MEX","FRA","AUS","GBR","AUS","HKG","USA","JPN","CAN","CAN","0","CHE","CAN","USA","DEU","SGP","DEU","USA","USA","ESP","AUT","AUS","0","AUS","ARG","TWN","CHN","GBR","DNK","AUS","GBR","USA","IRL","CHN","JPN","SWE","ITA","NLD","AUS","FIN","ESP","USA","USA","RUS","CHL","GBR","USA","BEL","JPN","CZE","MEX","FRA","GBR","SGP","AUS","AUS","CHE","HKG","USA","CAN","DEU","DEU","USA","CAN","0","IRL","AUT","JPN","0","CHN","DNK","USA","CAN","USA","ITA","ESP","AUS","SWE","TWN","GBR","AUS","ESP","GBR","BEL","ARG","CHN","NLD","AUS","USA","AUS","RUS","FRA","USA","MYS","USA","CZE","MEX","FIN","NOR","CHL","JPN"],"marker":{"line":{"colorbar":{"title":"","ticklen":2},"cmin":1,"cmax":120,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":"rgba(190,190,190,1)","width":0.5}},"type":"choropleth","geo":"geo","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->

## Grouped boxplots


```r
library(reshape2)

data2019 <- data[data$Year==2019,]
top <- data2019[data2019$Rank<11,]
datatop <- data[data$City %in% top$City,]
datatop <- melt(datatop[,c(3,5:10)],id.vars = "City")
colnames(datatop) <- c("City", "Indicator", "Score")

p <- plot_ly(datatop, x = ~City, y = ~Score, color = ~Indicator, type = "box") %>%
  layout(boxmode = "group", title = "Top 10 cities of 2019 by QS BSC and their scores in the last 6 years")

p
```

```
## Warning: 'layout' objects don't have these attributes: 'boxmode'
## Valid attributes include:
## 'font', 'title', 'autosize', 'width', 'height', 'margin', 'paper_bgcolor', 'plot_bgcolor', 'separators', 'hidesources', 'showlegend', 'colorway', 'datarevision', 'uirevision', 'editrevision', 'selectionrevision', 'template', 'modebar', 'meta', 'transition', '_deprecated', 'clickmode', 'dragmode', 'hovermode', 'hoverdistance', 'spikedistance', 'hoverlabel', 'selectdirection', 'grid', 'calendar', 'xaxis', 'yaxis', 'ternary', 'scene', 'geo', 'mapbox', 'polar', 'radialaxis', 'angularaxis', 'direction', 'orientation', 'editType', 'legend', 'annotations', 'shapes', 'images', 'updatemenus', 'sliders', 'colorscale', 'coloraxis', 'metasrc', 'barmode', 'bargap', 'mapType'
```

<!--html_preserve--><div id="htmlwidget-fc80a41e9b844426cbd2" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-fc80a41e9b844426cbd2">{"x":{"visdat":{"6d6119adff":["function () ","plotlyVisDat"]},"cur_data":"6d6119adff","attrs":{"6d6119adff":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"box"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"boxmode":"group","title":"Top 10 cities of 2019 by QS BSC and their scores in the last 6 years","xaxis":{"domain":[0,1],"automargin":true,"title":"City","type":"category","categoryorder":"array","categoryarray":["Berlin","Hong Kong","London","Melbourne","Montreal","Munich","Paris","Seoul","Sydney","Tokyo","Zurich"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Score"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"fillcolor":"rgba(102,194,165,0.5)","x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong","London","Tokyo","Melbourne","Montreal","Paris","Munich","Berlin","Zurich","Sydney","Seoul","Hong Kong","Montreal","Paris","London","Seoul","Melbourne","Berlin","Tokyo","Munich","Hong Kong","Sydney","Zurich","Paris","Melbourne","Tokyo","Sydney","London","Montreal","Hong Kong","Berlin","Seoul","Munich","Zurich","Paris","Melbourne","London","Sydney","Hong Kong","Tokyo","Montreal","Seoul","Zurich","Munich","Berlin","Paris","London","Sydney","Melbourne","Zurich","Hong Kong","Montreal","Munich","Berlin","Seoul","Tokyo"],"y":[100,83,69,54,50,57,81,63,65,95,74,100,84,68,57,93,54,49,63,64,93,72,59,98,100,96,70,50,84,55,74,65,65,96,67,81,63,100,61,72,49,88,53,64,96,69,100,65,74,79,63,87,61,54,49,95,100,86,89,78,94,85,70,69,93,92],"type":"box","name":"Rankings","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(252,141,98,0.5)","x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong","London","Tokyo","Melbourne","Montreal","Paris","Munich","Berlin","Zurich","Sydney","Seoul","Hong Kong","Montreal","Paris","London","Seoul","Melbourne","Berlin","Tokyo","Munich","Hong Kong","Sydney","Zurich","Paris","Melbourne","Tokyo","Sydney","London","Montreal","Hong Kong","Berlin","Seoul","Munich","Zurich","Paris","Melbourne","London","Sydney","Hong Kong","Tokyo","Montreal","Seoul","Zurich","Munich","Berlin","Paris","London","Sydney","Melbourne","Zurich","Hong Kong","Montreal","Munich","Berlin","Seoul","Tokyo"],"y":[92,59,100,87,79,92,80,84,97,72,80,92,55,100,94,80,74,75,83,97,67,78,93,79,90,63,100,70,48,72,77,95,80,80,100,51,95,91,95,79,75,65,72,83,83,100,93,95,80,55,96,71,82,75,77,86,98,94,100,81,85,91,72,72,72,49],"type":"box","name":"Student.Mix","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(141,160,203,0.5)","x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong","London","Tokyo","Melbourne","Montreal","Paris","Munich","Berlin","Zurich","Sydney","Seoul","Hong Kong","Montreal","Paris","London","Seoul","Melbourne","Berlin","Tokyo","Munich","Hong Kong","Sydney","Zurich","Paris","Melbourne","Tokyo","Sydney","London","Montreal","Hong Kong","Berlin","Seoul","Munich","Zurich","Paris","Melbourne","London","Sydney","Hong Kong","Tokyo","Montreal","Seoul","Zurich","Munich","Berlin","Paris","London","Sydney","Melbourne","Zurich","Hong Kong","Montreal","Munich","Berlin","Seoul","Tokyo"],"y":[84,100,92,90,89,90,86,96,99,72,80,80,97,91,89,80,89,88,94,95,67,78,94,81,81,73,97,92,98,91,80,100,97,81,92,98,100,83,92,84,92,68,85,96,83,94,71,98,88,95,83,66,95,87,88,84,81,99,85,99,59,79,97,83,55,70],"type":"box","name":"Desirability","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(231,138,195,0.5)","x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong","London","Tokyo","Melbourne","Montreal","Paris","Munich","Berlin","Zurich","Sydney","Seoul","Hong Kong","Montreal","Paris","London","Seoul","Melbourne","Berlin","Tokyo","Munich","Hong Kong","Sydney","Zurich","Paris","Melbourne","Tokyo","Sydney","London","Montreal","Hong Kong","Berlin","Seoul","Munich","Zurich","Paris","Melbourne","London","Sydney","Hong Kong","Tokyo","Montreal","Seoul","Zurich","Munich","Berlin","Paris","London","Sydney","Melbourne","Zurich","Hong Kong","Montreal","Munich","Berlin","Seoul","Tokyo"],"y":[93,100,88,80,80,78,88,90,86,89,85,93,100,86,80,88,78,80,90,84,92,78,80,88,94,96,86,79,100,80,81,85,85,87,91,100,87,96,75,83,73,92,77,82,96,94,100,94,82,94,78,94,77,71,68,95,95,90,90,84,96,71,72,75,87,91],"type":"box","name":"Employer.Activity","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"line":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(166,216,84,0.5)","x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong","London","Tokyo","Melbourne","Montreal","Paris","Munich","Berlin","Zurich","Sydney","Seoul","Hong Kong","Montreal","Paris","London","Seoul","Melbourne","Berlin","Tokyo","Munich","Hong Kong","Sydney","Zurich","Paris","Melbourne","Tokyo","Sydney","London","Montreal","Hong Kong","Berlin","Seoul","Munich","Zurich","Paris","Melbourne","London","Sydney","Hong Kong","Tokyo","Montreal","Seoul","Zurich","Munich","Berlin","Paris","London","Sydney","Melbourne","Zurich","Hong Kong","Montreal","Munich","Berlin","Seoul","Tokyo"],"y":[22,53,27,62,67,43,41,43,22,41,54,25,54,33,47,38,67,71,42,23,44,53,56,38,18,37,18,73,36,68,47,12,34,62,49,63,44,16,57,57,82,56,81,44,54,40,28,36,63,62,60,54,55,72,74,57,41,38,40,62,69,65,78,83,62,61],"type":"box","name":"Affordability","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"line":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(255,217,47,0.5)","x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong","London","Tokyo","Melbourne","Montreal","Paris","Munich","Berlin","Zurich","Sydney","Seoul","Hong Kong","Montreal","Paris","London","Seoul","Melbourne","Berlin","Tokyo","Munich","Hong Kong","Sydney","Zurich","Paris","Melbourne","Tokyo","Sydney","London","Montreal","Hong Kong","Berlin","Seoul","Munich","Zurich","Paris","Melbourne","London","Sydney","Hong Kong","Tokyo","Montreal","Seoul","Zurich","Munich","Berlin","Paris","London","Sydney","Melbourne","Zurich","Hong Kong","Montreal","Munich","Berlin","Seoul","Tokyo"],"y":[94,85,99,100,98,99,82,80,86,85,81,92,89,98,100,84,99,94,82,90,86,84,97,83,81,94,89,89,84,78,70,65,52,84,94,87,78,87,99,77,92,90,89,67,84,94,87,78,77,87,99,90,67,89,92,84,87,78,94,67,77,99,89,92,90,87],"type":"box","name":"Student.View","marker":{"color":"rgba(255,217,47,1)","line":{"color":"rgba(255,217,47,1)"}},"line":{"color":"rgba(255,217,47,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->

## Stacked barplot


```r
data_plot <- data2019[data2019$Rank<11,c(3,5:10)]

data_plot1 <- melt(data_plot, id.vars = "City")
colnames(data_plot1) <- c("City", "Indicator", "Score")
p <- plot_ly(data_plot1,x = ~City, y = ~Score, color = ~Indicator) %>%
  layout(yaxis = list(title = 'Scores'), barmode = 'stack', title='QS Best Student Cities 2019 for the Top 10')

p
```

```
## No trace type specified:
##   Based on info supplied, a 'bar' trace seems appropriate.
##   Read more about this trace type -> https://plot.ly/r/reference/#bar
```

<!--html_preserve--><div id="htmlwidget-5deb17a90723db4ae7fd" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-5deb17a90723db4ae7fd">{"x":{"visdat":{"6d63de7a03f":["function () ","plotlyVisDat"]},"cur_data":"6d63de7a03f","attrs":{"6d63de7a03f":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"yaxis":{"domain":[0,1],"automargin":true,"title":"Scores"},"barmode":"stack","title":"QS Best Student Cities 2019 for the Top 10","xaxis":{"domain":[0,1],"automargin":true,"title":"City","type":"category","categoryorder":"array","categoryarray":["Berlin","Hong Kong","London","Melbourne","Montreal","Munich","Paris","Seoul","Sydney","Tokyo","Zurich"]},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[100,83,69,54,50,57,81,63,65,95,74],"type":"bar","name":"Rankings","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[92,59,100,87,79,92,80,84,97,72,80],"type":"bar","name":"Student.Mix","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[84,100,92,90,89,90,86,96,99,72,80],"type":"bar","name":"Desirability","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[93,100,88,80,80,78,88,90,86,89,85],"type":"bar","name":"Employer.Activity","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[22,53,27,62,67,43,41,43,22,41,54],"type":"bar","name":"Affordability","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[94,85,99,100,98,99,82,80,86,85,81],"type":"bar","name":"Student.View","marker":{"color":"rgba(255,217,47,1)","line":{"color":"rgba(255,217,47,1)"}},"textfont":{"color":"rgba(255,217,47,1)"},"error_y":{"color":"rgba(255,217,47,1)"},"error_x":{"color":"rgba(255,217,47,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->

```r
p <- plot_ly(data_plot1,x = ~City, y = ~Score, color = ~Indicator) %>%
  layout(title='QS Best Student Cities 2019 for the Top 10')

p
```

```
## No trace type specified:
##   Based on info supplied, a 'bar' trace seems appropriate.
##   Read more about this trace type -> https://plot.ly/r/reference/#bar
```

<!--html_preserve--><div id="htmlwidget-e4d67e68a1b5c0e7e177" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e4d67e68a1b5c0e7e177">{"x":{"visdat":{"6d631c9a7d9":["function () ","plotlyVisDat"]},"cur_data":"6d631c9a7d9","attrs":{"6d631c9a7d9":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"QS Best Student Cities 2019 for the Top 10","xaxis":{"domain":[0,1],"automargin":true,"title":"City","type":"category","categoryorder":"array","categoryarray":["Berlin","Hong Kong","London","Melbourne","Montreal","Munich","Paris","Seoul","Sydney","Tokyo","Zurich"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Score"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[100,83,69,54,50,57,81,63,65,95,74],"type":"bar","name":"Rankings","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[92,59,100,87,79,92,80,84,97,72,80],"type":"bar","name":"Student.Mix","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[84,100,92,90,89,90,86,96,99,72,80],"type":"bar","name":"Desirability","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[93,100,88,80,80,78,88,90,86,89,85],"type":"bar","name":"Employer.Activity","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[22,53,27,62,67,43,41,43,22,41,54],"type":"bar","name":"Affordability","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["London","Tokyo","Melbourne","Munich","Berlin","Montreal","Paris","Zurich","Sydney","Seoul","Hong Kong"],"y":[94,85,99,100,98,99,82,80,86,85,81],"type":"bar","name":"Student.View","marker":{"color":"rgba(255,217,47,1)","line":{"color":"rgba(255,217,47,1)"}},"textfont":{"color":"rgba(255,217,47,1)"},"error_y":{"color":"rgba(255,217,47,1)"},"error_x":{"color":"rgba(255,217,47,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->
